generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model users {
  id              String           @id @default(cuid())
  firebase_uid    String           @unique
  email           String           @unique
  first_name      String
  last_name       String
  personal_id     String?          @unique
  auth_provider   AuthProvider     @default(EMAIL)
  role            Role             @default(USER)
  created_at      DateTime         @default(now())
  updated_at      DateTime         @updatedAt
  orders          orders[]
  cart_items      cart_items[]
  clinics         clinics[]
  clinic_requests clinic_requests[]
  addresses       addresses[]
}

model addresses {
  id         String   @id @default(cuid())
  user_id    String
  user       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  city       String
  address    String
  is_default Boolean  @default(false)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt
}

enum AuthProvider {
  EMAIL
  GOOGLE
}

enum Role {
  USER
  ADMIN
  CLINIC
}

model clinics {
  id                    String   @id @default(cuid())
  user_id               String
  user                  users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  clinic_name           String
  identification_number String   @unique
  email                 String
  description           String?
  city                  String
  address               String
  phone_number          String
  is_active             Boolean  @default(true)
  created_at            DateTime @default(now())
  updated_at            DateTime @updatedAt
}

model clinic_requests {
  id                    String              @id @default(cuid())
  user_id               String
  user                  users               @relation(fields: [user_id], references: [id], onDelete: Cascade)
  clinic_name           String
  identification_number String
  email                 String
  description           String?
  city                  String
  address               String
  phone_number          String
  status                ClinicRequestStatus @default(PENDING)
  admin_notes           String?
  created_at            DateTime            @default(now())
  updated_at            DateTime            @updatedAt
}

enum ClinicRequestStatus {
  PENDING
  APPROVED
  REJECTED
}

model categories {
  id         String       @id @default(cuid())
  name       String
  name_ka    String
  slug       String       @unique
  image      String?
  parent_id  String?
  parent     categories?  @relation("category_to_category", fields: [parent_id], references: [id])
  children   categories[] @relation("category_to_category")
  products   products[]
  created_at DateTime     @default(now())
  updated_at DateTime     @updatedAt
}

model products {
  id             String        @id @default(cuid())
  name           String
  name_ka        String
  description    String?
  description_ka String?
  manufacturer   String?
  price          Decimal       @db.Decimal(10, 2)
  sale_price     Decimal?      @db.Decimal(10, 2)
  sku            String        @unique
  stock          Int           @default(0)
  images         String[]
  category_id    String
  category       categories    @relation(fields: [category_id], references: [id])
  order_items    order_items[]
  cart_items     cart_items[]
  created_at     DateTime      @default(now())
  updated_at     DateTime      @updatedAt
}

model orders {
  id         String        @id @default(cuid())
  user_id    String
  user       users         @relation(fields: [user_id], references: [id])
  status     OrderStatus   @default(PENDING)
  total      Decimal       @db.Decimal(10, 2)
  items      order_items[]
  created_at DateTime      @default(now())
  updated_at DateTime      @updatedAt
}

enum OrderStatus {
  PENDING
  PROCESSING
  SHIPPED
  DELIVERED
  CANCELLED
}

model order_items {
  id         String   @id @default(cuid())
  order_id   String
  order      orders   @relation(fields: [order_id], references: [id])
  product_id String
  product    products @relation(fields: [product_id], references: [id])
  quantity   Int
  price      Decimal  @db.Decimal(10, 2)
}

model cart_items {
  id         String   @id @default(cuid())
  user_id    String
  user       users    @relation(fields: [user_id], references: [id], onDelete: Cascade)
  product_id String
  product    products @relation(fields: [product_id], references: [id], onDelete: Cascade)
  quantity   Int      @default(1)
  created_at DateTime @default(now())
  updated_at DateTime @updatedAt

  @@unique([user_id, product_id])
}
